<h1>This just popped into my head...</h1>

<%= form_for(@thought) do |f| %>
  	<% if @thought.errors.any? %>
  	  <div id="error_explanation">
  	    <h2><%= pluralize(@thought.errors.count, "error") %> prohibited this thought from being saved:</h2>

  	    <ul>
  	    <% @thought.errors.full_messages.each do |msg| %>
  	      <li><%= msg %></li>
  	    <% end %>
  	    </ul>
  	  </div>
  	<% end %>

	<div class="field">
		<span>Remember to: </span>
		<%= f.text_field :idea, :autocomplete => false %><div id="counter"></div>
	</div>
	<div class="field">
		<span>I'll do this: </span>
		<%= f.select :timeframe, [" ", "Soon", "Someday", "By Date", "Every"] %><br />
		<div id="select_date" style=" display: none; ">
			<%= f.text_field :timeframe_date %><br />
		</div>
	</div>
	<div class="field">
		<span>Tag this to: </span>
		<%= f.text_field :tag, :autocomplete => false %><br />
	</div>
	<div class="field">
		<span>A litte note: </span>
		<%= f.select :note_type, ["", "Picture", "Link", "Location", "Email", "Text" ] %><br />
		<div id="note_content" style=" display: none; ">
			<%= f.text_area :note_content, :rows => 1 %><br />
		</div>
	</div>
	<div class="field">
		<%= f.hidden_field :user_id, :value => 1 %>
	</div>


  <div class="actions">
    <%= f.submit :value => "Remember!" %>
  </div>
<% end %>

<%= link_to 'Back', thoughts_path %><br />
<%= link_to 'Home', root_url %>

<script>
	$(function(){
		var max_length = 30;
		// get current number of characters
		$('#counter').html(max_length - $('#thought_idea').val().length);

		$('#thought_idea').keyup(function()
		{
			// get new length of characters
			if ($(this).val().length >= max_length)
			{
				$('#counter').html('You have reached the maximum limit of ' + max_length);
				$(this).val($(this).val().substr(0, max_length));
			}
			else
			{
				$('#counter').html(max_length - $(this).val().length);
			}
		});

		//Autocomplete idea and tag
		var available_ideas = ["Laguinitas Maximus IPA"];
		var available_tags = ["Beer"];
		$("#thought_idea").autocomplete({ source: available_ideas });
		$("#thought_tag").autocomplete({ source: available_tags });

	});

	$("#thought_timeframe").change(function(){
		if ($("#thought_timeframe option:selected").val() == "By Date")
		{	$("#select_date").show();
			$("#thought_timeframe_date").datepicker().focus();
		}
		else{
			$("#select_date").hide();
		}
	});

	$("#thought_note_type").change(function(){
		if ($("#thought_note_type option:selected").val() == "Location")
		{	$("#note_content").slideDown();

			function showMap(position) {
    	  		// Show a map centered at (position.coords.latitude, position.coords.longitude).
				$("#thought_note_content").val(position.coords.latitude+","+position.coords.longitude).attr('rows', 1);
			}

			// One-shot position request.
    		navigator.geolocation.getCurrentPosition(showMap);
		}
		else if ($("#thought_note_type option:selected").val() == "Link")
		{
			$("#note_content").slideDown();
			$("#thought_note_content").val(window.location).attr('rows', 1);
		}
		else if ($("#thought_note_type option:selected").val() == "Text")
		{
			$("#note_content").slideDown();

			$("#thought_note_content").attr('rows', 5).val("");
		}

		else{
			$("#note_content").hide();
		}
	});

</script>
