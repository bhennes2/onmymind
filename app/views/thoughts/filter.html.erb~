<h1><%= @title %></h1>

<% if params[:type] == "timeframe" %>
	<a id="title_soon">Soon (<%= @thoughts_soon.count %>)</a> | <a id="title_someday">Someday (<%= @thoughts_someday.count %>)</a> | <a id="title_by_date">By Date (<%= @thoughts_by_date.count %>)</a> | <a id="title_every">Every (<%= @thoughts_every.count %>)</a>
	<div id="results_timeframe">
		<ul id="list_soon" >
			<% @thoughts_soon.each do |thought| %>
				<li><%= thought.idea %> | <%= thought.tag %> | <%= link_to 'View', thought %></li>
			<% end %>
		</ul>
		<ul id="list_someday" style=" display: none; " >
			<% @thoughts_someday.each do |thought| %>
				<li><%= thought.idea %> | <%= thought.tag %> | <%= link_to 'View', thought %></li>
			<% end %>
		</ul>
		<ul id="list_by_date" style=" display: none; " >
			<% @thoughts_by_date.each do |thought| %>
				<li><%= thought.idea %> | <%= thought.timeframe_date %> | <%= thought.tag %> | <%= link_to 'View', thought %></li>
			<% end %>
		</ul>
		<ul id="list_every" style=" display: none; " >
			<% @thoughts_every.each do |thought| %>
				<li><%= thought.idea %> | <%= thought.tag %> | <%= link_to 'View', thought %></li>
			<% end %>
		</ul>
	</div>

<%= link_to 'New Thought', new_thought_path %><br />
<%= link_to 'Back', thoughts_path %>

<% end %>

<% if params[:type] == "tag" %>
	<% if !@thoughts.nil? %>
		<% flag = "" %>
		<% counter = 0 %>
		<% @thoughts.each_cons(2) do |thought, next_thought| %>
			<% if flag != thought.tag %>
				<span id="<%= thought.id %>"><%= thought.tag %></span>
				<ul id="ul<%= thought.id %>">
			<% end %>
					<li><%= thought.id %> | <%= thought.idea %> | <%= thought.timeframe %></li>
			<% if next_thought.tag != thought.tag %>
				</ul>
			<% end %>
			<% flag = thought.tag %>
			<% counter += 1 %>
			<% if counter == (@thoughts.size - 1) %>
				<% if next_thought.tag == thought.tag %>
					<li><%= thought.id %> | <%= thought.idea %> | <%= thought.timeframe %></li>
				</ul>
				<% else %>
				<span><%= next_thought.tag %></span>
				<ul>
					<li><%= next_thought.id %> | <%= next_thought.idea %> | <%= next_thought.timeframe %></li>
				</ul>
				<% end %>
			<% end %>
		<% end %>
	<% end %>
<%= link_to 'New Thought', new_thought_path %><br />
<%= link_to 'Back', thoughts_path %>

<% end %>

<% if params[:type] == "location" %>
	<p>Display <strong><%= @thoughts.count %></strong> ideas on the map near you!</p>
	<p>Filter by: <a onclick="filter_map('all');">All</a> |
	<% if !@thoughts.nil? %>
		<% flag = "" %>
		<% counter = 0 %>
		<% @thoughts.each_cons(2) do |thought, next_thought| %>
			<% if flag != thought.tag %>
				<a id="<%= thought.tag %>" onclick="filter_map($(this).attr('id'));"><%= thought.tag %></a> |
			<% end %>
			<% flag = thought.tag %>
			<% counter += 1 %>
			<% if counter == (@thoughts.size - 1) %>
				<% if next_thought.tag != thought.tag %>
					<a id="<%= next_thought.tag %>" onclick="filter_map($(this).attr('id'));"><%= next_thought.tag %></a>
				<% end %>
			<% end %>

		<% end %>
	<% end %></p>
	<script>
	var marker = [];
	function showMap(position) {
		// Show a map centered at (position.coords.latitude, position.coords.longitude).
		var myOptions = {
          		center: new google.maps.LatLng(position.coords.latitude,position.coords.longitude),
          		zoom: 14,
          		mapTypeId: google.maps.MapTypeId.ROADMAP,
			zoomControl: true
        	};
	        var map = new google.maps.Map(document.getElementById("map_canvas"),
        	    myOptions);
		var marker_here = new google.maps.Marker({
      			position: new google.maps.LatLng(position.coords.latitude,position.coords.longitude),
			map: map,
			title:"You are here!",
			icon: "/assets/blue-dot.png",
			options: { visible: true }
		});

		var infowindow = [];
		var counter = 0;
		<% @thoughts.each do |thought| %>
			marker[counter] = new google.maps.Marker({
				position: new google.maps.LatLng(<%= thought.location_content %>),
				map: map,
				title: "<%= thought.tag %>",
				options: { animation: google.maps.Animation.DROP, zIndex: counter, visible: true }
			});
			infowindow[counter] = new google.maps.InfoWindow({
				content: "<p><%= thought.tag %> | <%= thought.idea %></p><p><%= thought.created_at %></p>",
				zIndex: counter
			});
			google.maps.event.addListener(marker[counter], 'click', function() {
				infowindow[this.zIndex].open(map,this);
			});
			counter++;
		<% end %>


	}

	function error(position) {
		alert("No location found!");
	}

	// One-shot position request.
	navigator.geolocation.getCurrentPosition(showMap, error, { enableHighAccuracy: true, requestAddress: true} );



	</script>
	<div id="map_canvas" style="width: 500px; height: 500px;"></div>
<%= link_to 'New Thought', new_thought_path %><br />
<%= link_to 'Back', thoughts_path %>
<% end %>

<script>
	function filter_map(tag){
		for (var i=0; i < marker.length; i++){
			if (marker[i].getTitle() == tag || tag == "all"){
				marker[i].setVisible(true);
			}
			else
				marker[i].setVisible(false);


		}
	}

	$("#title_soon").click(function(){
		$("#results_timeframe").children().hide();
		$("#list_soon").show()});
	$("#title_someday").click(function(){
		$("#results_timeframe").children().hide();
		$("#list_someday").show()});
	$("#title_by_date").click(function(){
		$("#results_timeframe").children().hide();
		$("#list_by_date").show()});
	$("#title_every").click(function(){
		$("#results_timeframe").children().hide();
		$("#list_every").show()});

	$("span").click(function(){
		$("ul"+$(this).attr('id')).toggle();
	});
</script>
